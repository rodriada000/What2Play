@model IEnumerable<GameDecider.Controllers.IgdbGame>

@{
    ViewBag.Title = "Search Results";
}

<br />
@using (Html.BeginForm("Index", "Search", FormMethod.Get))
{
@Html.Label("Search: "); @Html.TextBox("gamesearch"); <input type="submit" value="Search" />
}

<h1>Results</h1>
<table class="table">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.name)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.release_date)
        </th>
        @if (Request.IsAuthenticated)
        {
            <th>
            </th>
        }
    </tr>

@foreach (var item in Model) {
    <tr>
        <td>
            @{ string url = "https://igdb.com/games/" + item.name.Replace(' ', '-').ToLower(); }
            <a href="@url" style="color: black; text-decoration:none" target="_blank">@Html.DisplayFor(modelItem => item.name)</a>
        </td>
        <td>
            @if (item.release_date != null)
            {
                @item.release_date.Value.ToShortDateString();
            }
        </td>
        @if (Request.IsAuthenticated)
        {
            <td>
                <a id="add-link" href="#" onclick="javascript:ShowDialog('@item.id')">Add Game</a>
            </td>
        }
    </tr>
}
</table>

<div id="add-dialog"></div>

@section scripts
{
    <script type="text/javascript">
        $.ajaxSetup({ cache: false });

        function ShowDialog(id)
        {
            $("#add-dialog").dialog({
                autoOpen: true,
                title: "Select Platform",
                closeText: '',
                draggable: false,
                resizable: false,
                height: 400,
                width: 350,
                modal: true,
                open: function () {
                    url = "@Url.Action("AddGame", new { id_str = "JSVar" })";
                    url = url.replace("JSVar", id);
                    console.log(url);
                    $(this).load(url);
                },
            });
        }
    </script>
}